# Linux 下还有 root 权限无法修改或删除的文件？

在大多数人的认知中，Linux 系统里的 root 用户拥有“至高无上”的权限，理论上没有任何操作是 root 做不到的。然而，最近我在国产系统 deepin Linux v25 上却遇到一个让 root 也束手无策的文件——既无法修改，也无法删除。

事情的起因是这样的：我一直在使用一台迷你主机，系统装的是 deepin Linux v25。偶尔我会把这台设备带回家使用，在家时会启动 VPN 客户端。再次回到公司后，这台机器虽然能正常获取内网的 IP 地址，使用浏览器也能访问外网，但唯独无法访问公司内部的网站。

这个现象很容易联想到 DNS 配置异常。于是我查看 `/etc/resolv.conf`，果然不对劲：

```
# Generated by Astrill
nameserver 1.1.1.2
```

按理说，系统的网络管理器应该根据 DHCP 下发的信息自动更新这个文件，正常情况下它的内容应该类似于：

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_01.png)

难道 DHCP 没有下发 DNS？我于是打开网络设置界面，手动指定了 DNS 服务器。

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_02.png)

结果依然无效。

既然 GUI 不行，那我就直接手动编辑这个文件吧。执行：

```
sudo vi /etc/resolv.conf
```

系统却提示该文件不可修改。

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_03.png)

即便我强制保存，也仍然无法成功。

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_04.png)

删除也不行：

```bash
$ sudo rm /etc/resolv.conf
rm: 无法删除 '/etc/resolv.conf': 不允许的操作
```

再看看文件属性，既不是链接，权限也没有问题：

```
$ ls -la /etc/resolv.conf
-rw-r--r-- 1 root root 61 11月27日 20:08 /etc/resolv.conf
```

到这里我只能祭出“终极命令”——`lsattr` 查看扩展属性：

```
$ lsattr /etc/resolv.conf
----i---------e------- /etc/resolv.conf
```

真相大白：文件被设置了不可更改属性。

可能有些读者对 `lsattr` 并不熟悉，它是 Linux 下用于查看 ext2/ext3/ext4 文件系统扩展属性的命令。这些扩展属性可以决定文件在特定情况下的表现，例如：

* 文件不可修改、不可删除
* 文件内容只允许追加
* 文件不会缓存到内存
* 强制同步写入
* 文件只读但可读取内容
* ...

每个字母都是一个特殊属性，例如上面 i 表示 immutable（不可变）。这种扩展属性是内核层面的控制，普通文件权限（rwx）操作无法覆盖。这就可以解释为什么我们无法手动修改和删除该文件。

如果真的需要修改或删除这个文件，其实也并非完全无解。关键在于——必须先解除它的扩展属性。比如执行：

```
$ sudo chattr -i /etc/resolv.conf
请输入密码:
验证成功
$ lsattr /etc/resolv.conf
--------------e------- /etc/resolv.conf
```

当 `i`（immutable）属性被移除后，root 用户就能正常修改甚至删除这个文件了。

那为什么系统或某些软件要特意给文件加上这么一道“锁”呢？主要原因包括：

* **防止关键配置被意外修改**
  某些系统级配置文件一旦被误改，可能导致网络、启动甚至系统稳定性出现问题。

* **防止恶意软件或病毒篡改系统文件**
  即便你的账户具备 sudo 权限，没有解除扩展属性，恶意进程也无法直接修改这些文件。

* **保护 Web 目录内容，避免网站被恶意篡改**

* **限制日志只能追加而不能覆盖**
  提高审计可靠性，避免攻击者清空日志掩盖踪迹。

* **防止用户误删重要文件**
  尤其是在多人协作或大量使用 sudo 的环境下，保护机制能够避免“手滑事故”。

对于许多拥有 sudo 权限的用户来说，修改系统文件往往只需在命令前加个 sudo，而扩展属性则构成了更深一层的安全保障。毕竟，要绕这么一大圈才能修改文件，大部分用户即便知道方法，也会多留一个心眼。

好了，今天关于 Linux 的一则小冷知识就分享到这里。欢迎继续关注，获取更多与信创 Linux 系统相关的经验与技巧！

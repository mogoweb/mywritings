# Linux 下还有 root 权限用户无法修改和删除的文件？

在我们的认知中，Linux 系统中 root 用户拥有至高无限的权限，没有什么操作是 root 用户无法做的。但是今天在国产系统 deepin Linux v25 系统上就发现有个文件无法删除，也无法卸载。

这件事这样的，我之前一直使用的迷你主机，上面安装的是 deepin Linux v25 系统。这台迷你主机偶尔会带回家使用，在家使用时，使用了 VPN 接入客户端。回到公司，使用该迷你主机连接公司内网，可以获取到内网 IP 地址。使用过程中发现，使用浏览器能够访问外网，但是无法访问内部网站。看这个现象，很容易想到是公司 内网的 DNS 服务器未获取到。打开 `/etc/resolv.conf` 文件一看，果然不太对：

> # Generated by Astrill
>
> nameserver 1.1.1.2

正常情况下，系统的网络管理器会根据 DHCP 服务获取到的信息修改这个文件，内容应该是：

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_01.png)

是 DHCP 获取 IP 地址时，没有自动获取到 DNS 信息吗？于是我进入到网络设置，手动指定一个 DNS 服务器。

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_02.png)

还是不行。

于是我就想，干脆手工编辑一下这个文件，手动写入内网 DNS 服务器地址。当我输入 sudo vi /etc/resolv.conf 命令编辑该文件时提示：

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_03.png)

就算我修改了内容，强行保存，依然无法成功。

![](https://raw.githubusercontent.com/mogoweb/mywritings/master/book_wechat/2025/202511/images/deepin_immutable_04.png)

强行删除这个文件呢？

``` bash
$ sudo rm /etc/resolv.conf
rm: 无法删除 '/etc/resolv.conf': 不允许的操作
```

查看该文件的属性，也不是链接文件，权限也没有问题：

```
$ ls -la /etc/resolv.conf
-rw-r--r-- 1 root root 61 11月27日 20:08 /etc/resolv.conf
```

祭出最后的绝招，使用 `lsattr` 命令查看文件的属性：

```
$ lsattr /etc/resolv.conf
----i---------e------- /etc/resolv.conf
```

真相大白了。可能很多人还不知道 `lsattr` 命令，它用于查看 文件的扩展属性（extended attributes），特别是在 ext2/ext3/ext4 文件系统 上。

这些扩展属性可以控制文件的特殊行为，例如：

* 文件不能被删除

* 文件内容只能追加

* 文件不会被缓存到内存

* 写入方式变成同步写

* 文件不可修改但可以读取

* ...

每个字母都是一个特殊属性，例如上面 i 表示 immutable（不可变）。这种扩展属性是内核层面的控制，普通文件权限（rwx）操作无法覆盖。这就可以解释为什么我们无法手动修改和删除该文件。

如果真的想要修改和删除这个文件呢？办法也不是没有，首先得修改这个文件的扩展属性，比如：

```
$ sudo chattr -i /etc/resolv.conf
请输入密码:
验证成功
$ lsattr /etc/resolv.conf
--------------e------- /etc/resolv.conf

```

这样，root 用户就可以修改这个文件了。为什么要这么绕一道呢？主要作用是：

* 防止关键配置被意外修改

* 防止恶意软件或病毒篡改系统文件

* 保护 Web 目录内容，防止网站被恶意篡改：

* 设置日志只能追加不可覆盖，避免攻击者篡改日志：

* 防止用户误删除重要文件

很多用户的登陆账号都是有 root 权限的，做一些系统级操作，需要在命令前加上 sudo，这能避免一部分意外操作，而对于一些关键配置文件，通过使用扩展属性，可以防止用户误删除重要文件，毕竟要绕这么一大圈，很多用户也不会，即使会，也会警觉起来。

好了，今天一点 Linux 冷知识，就分享到这里。更多的信创 Linux 系统知识，敬请关注！

